<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PiWorldBank</title>

  <!-- PWA(있으면 좋음: 없어도 페이지는 정상 작동) -->
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#111827" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <style>
    :root{
      --bg: radial-gradient(1200px 700px at 28% 18%, rgba(120,70,255,.26), rgba(17,24,39,1) 58%, rgba(10,12,20,1));
      --card: rgba(255,255,255,.07);
      --border: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --accent: #facc15;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:18px;
    }
    .wrap{
      width:min(980px, 100%);
      background: rgba(0,0,0,.28);
      border:1px solid var(--border);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding:18px;
    }
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 10px;
    }
    .brand{
      font-weight: 900;
      letter-spacing: .2px;
      padding:8px 10px;
      border-radius: 12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      user-select:none;
    }

    /* ✅ 언어칸: 작게, 칸 하나(옛날 스타일) */
    .langbox{
      display:flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius: 12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      font-size:12px;
      user-select:none;
    }
    .langbox label{
      color: var(--muted);
      font-weight: 800;
      letter-spacing: .04em;
    }
    .langbox select{
      font-size:12px;
      font-weight: 900;
      border:none;
      outline:none;
      background: transparent;
      color: var(--text);
      padding:0;
      margin:0;
      cursor:pointer;
      max-width: 160px;
    }
    .langbox select option{ color:#111; }

    header{
      text-align:center;
      padding: 8px 10px 14px;
    }
    .logo{
      width:58px; height:58px;
      margin: 0 auto 8px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(250,204,21,.95), rgba(168,85,247,.95));
      display:grid;
      place-items:center;
      font-weight: 900;
      color:#111;
      box-shadow: 0 16px 34px rgba(0,0,0,.35);
    }
    h1{ margin:0; font-size: 30px; letter-spacing:.2px; }
    .tagline{
      margin-top:6px;
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .20em;
      text-transform: uppercase;
    }
    .people{
      margin-top:6px;
      font-size: 13px;
      color: var(--accent);
      font-weight: 900;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 8px;
    }
    .card{
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      border-radius: 14px;
      padding: 14px;
      min-height: 66px;
      user-select:none;
    }
    .card .title{
      font-weight: 900;
      font-size: 14px;
      margin:0 0 4px 0;
    }
    .card .desc{
      margin:0;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.3;
    }

    .section{
      margin-top: 14px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      border-radius: 14px;
      padding: 14px;
    }
    .section .head{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .small{
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }
    .actions{
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:flex-end;
      flex-wrap: wrap;
    }
    .btn{
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 900;
      cursor:pointer;
      user-select:none;
    }
    .btn.primary{
      background: var(--accent);
      color:#111;
      border-color: rgba(0,0,0,.12);
    }
    .btn:disabled{
      opacity:.5;
      cursor:not-allowed;
    }

    .footer{
      margin-top: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap: wrap;
    }
    .links{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
    }
    .linkbtn{
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 12px;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .status{
      display:flex;
      align-items:center;
      gap:8px;
      font-size: 12px;
      color: var(--muted);
    }
    .dot{
      width:8px; height:8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34,197,94,.4);
    }

    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
      h1{ font-size: 26px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">PiWorldBank</div>

      <!-- ✅ 언어칸: 작게, 칸 하나 -->
      <div class="langbox" aria-label="Language box">
        <label id="langLabel" for="langSelect">언어</label>
        <select id="langSelect" aria-label="Language select"></select>
      </div>
    </div>

    <header>
      <div class="logo">π</div>
      <h1 id="appTitle">PiWorldBank</h1>
      <div class="tagline" id="tagline">ONE WORLD · ONE PI · ONE FUTURE</div>
      <div class="people" id="people">사람이 먼저, 이윤은 그 다음</div>
    </header>

    <div class="grid">
      <div class="card"><p class="title" id="t1">기본소득</p><p class="desc" id="d1">UBI 지급/적립 (데모)</p></div>
      <div class="card"><p class="title" id="t2">결제</p><p class="desc" id="d2">결제 · 송금</p></div>
      <div class="card"><p class="title" id="t3">예치율</p><p class="desc" id="d3">31.4% 예치율 (데모)</p></div>
      <div class="card"><p class="title" id="t4">보상</p><p class="desc" id="d4">참여 보상</p></div>
      <div class="card"><p class="title" id="t5">고객센터</p><p class="desc" id="d5">문의/도움말</p></div>
      <div class="card"><p class="title" id="t6">FAQ</p><p class="desc" id="d6">약관 · 정책 · 안내</p></div>
    </div>

    <div class="section">
      <div class="head">
        <div>
          <div style="font-weight:900" id="installTitle">원클릭 설치 / 실행</div>
          <div class="small" id="installDesc">브라우저에서 “홈 화면에 추가(설치)”가 가능한 경우 버튼이 활성화됩니다.</div>
          <div class="small" id="installHint">팁: 캐시 때문에 화면이 꼬이면 “시크릿 창”으로 확인하세요.</div>
        </div>

        <div class="actions">
          <button class="btn" id="openBtn">Pi Browser로 열기</button>
          <button class="btn primary" id="installBtn" disabled>설치</button>
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="links">
        <!-- ✅ 링크는 <a href>로 고정: JS 오류로 망가질 일 없음 -->
        <a class="linkbtn" id="ytLink" href="https://www.youtube.com/@PiWorldBank" target="_blank" rel="noopener">YouTube</a>
        <a class="linkbtn" id="ttLink" href="https://www.tiktok.com/@piworldbank" target="_blank" rel="noopener">TikTok</a>
        <a class="linkbtn" id="mailLink" href="mailto:ljw2358@gmail.com">Email</a>
      </div>

      <div class="status">
        <span class="dot"></span>
        <span id="statusText">상태: OK</span>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // 1) 25개 언어 목록(드롭다운)
    // =========================
    // value는 BCP-47을 단순화(ko/en/ja/zh-Hans 등). 자동 감지에 사용.
    const LANG_LIST = [
      ["ko","한국어"],
      ["en","English"],
      ["ja","日本語"],
      ["zh-Hans","中文(简体)"],
      ["zh-Hant","中文(繁體)"],
      ["es","Español"],
      ["fr","Français"],
      ["de","Deutsch"],
      ["ru","Русский"],
      ["ar","العربية"],
      ["hi","हिन्दी"],
      ["vi","Tiếng Việt"],
      ["th","ไทย"],
      ["id","Bahasa Indonesia"],
      ["ms","Bahasa Melayu"],
      ["pt","Português"],
      ["it","Italiano"],
      ["nl","Nederlands"],
      ["tr","Türkçe"],
      ["pl","Polski"],
      ["uk","Українська"],
      ["sv","Svenska"],
      ["no","Norsk"],
      ["da","Dansk"],
      ["fi","Suomi"]
    ];

    // =========================
    // 2) 텍스트 테이블(핵심 용어 고정)
    // - 요청사항: 기본소득/보상/고객센터/예치율
    // - 나머지 언어는 "안전한 번역(짧게)"로만 제공
    // =========================
    const T = {
      ko:{
        dir:"ltr",
        langLabel:"언어",
        people:"사람이 먼저, 이윤은 그 다음",
        t1:"기본소득", d1:"UBI 지급/적립 (데모)",
        t2:"결제", d2:"결제 · 송금",
        t3:"예치율", d3:"31.4% 예치율 (데모)",
        t4:"보상", d4:"참여 보상",
        t5:"고객센터", d5:"문의/도움말",
        t6:"FAQ", d6:"약관 · 정책 · 안내",
        installTitle:"원클릭 설치 / 실행",
        installDesc:"브라우저에서 “홈 화면에 추가(설치)”가 가능한 경우 버튼이 활성화됩니다.",
        openBtn:"Pi Browser로 열기",
        installBtn:"설치",
        status:"상태: OK",
        hint:"팁: 캐시 때문에 화면이 꼬이면 “시크릿 창”으로 확인하세요."
      },
      en:{
        dir:"ltr",
        langLabel:"Language",
        people:"People first, profit later",
        t1:"Basic Income", d1:"UBI credit (demo)",
        t2:"Payments", d2:"Pay · Transfer",
        t3:"Deposit Rate", d3:"31.4% deposit rate (demo)",
        t4:"Rewards", d4:"Participation rewards",
        t5:"Help Center", d5:"Support / Contact",
        t6:"FAQ", d6:"Terms · Policy · Help",
        installTitle:"One-click Install / Launch",
        installDesc:"Enabled when “Add to Home Screen (Install)” is available.",
        openBtn:"Open in Pi Browser",
        installBtn:"Install",
        status:"Status: OK",
        hint:"Tip: If you see old UI, test in an Incognito window."
      },
      ja:{
        dir:"ltr",
        langLabel:"言語",
        people:"人が先、利益は後",
        t1:"ベーシックインカム", d1:"UBI（デモ）",
        t2:"決済", d2:"支払い・送金",
        t3:"預入利率", d3:"31.4%（デモ）",
        t4:"報酬", d4:"参加報酬",
        t5:"カスタマーセンター", d5:"問い合わせ/ヘルプ",
        t6:"FAQ", d6:"規約・方針・案内",
        installTitle:"ワンクリック インストール / 起動",
        installDesc:"「ホーム画面に追加(インストール)」が可能な場合に有効です。",
        openBtn:"Pi Browserで開く",
        installBtn:"インストール",
        status:"状態: OK",
        hint:"ヒント: 古い表示ならシークレットで確認。"
      },
      "zh-Hans":{
        dir:"ltr",
        langLabel:"语言",
        people:"以人为本，其次利润",
        t1:"基本收入", d1:"UBI（演示）",
        t2:"支付", d2:"支付 · 转账",
        t3:"存款利率", d3:"31.4%（演示）",
        t4:"奖励", d4:"参与奖励",
        t5:"客服中心", d5:"联系/帮助",
        t6:"FAQ", d6:"条款 · 政策 · 帮助",
        installTitle:"一键安装 / 启动",
        installDesc:"当浏览器支持“添加到主屏幕(安装)”时启用。",
        openBtn:"在 Pi Browser 打开",
        installBtn:"安装",
        status:"状态: OK",
        hint:"提示：若显示旧界面，请用无痕窗口检查。"
      },
      "zh-Hant":{
        dir:"ltr",
        langLabel:"語言",
        people:"以人為本，其次利潤",
        t1:"基本收入", d1:"UBI（示範）",
        t2:"支付", d2:"支付 · 轉帳",
        t3:"存款利率", d3:"31.4%（示範）",
        t4:"獎勵", d4:"參與獎勵",
        t5:"客服中心", d5:"聯絡/協助",
        t6:"FAQ", d6:"條款 · 政策 · 協助",
        installTitle:"一鍵安裝 / 啟動",
        installDesc:"當瀏覽器支援「加入主畫面(安裝)」時啟用。",
        openBtn:"在 Pi Browser 開啟",
        installBtn:"安裝",
        status:"狀態: OK",
        hint:"提示：若出現舊畫面，請用無痕視窗。"
      }
    };

    // 나머지 언어는 en을 기본으로 (안전, 깨짐 방지)
    const FALLBACK_LANG = "en";

    // =========================
    // 3) 자동 언어 감지
    // - 사용자가 선택한 값(localStorage)이 있으면 최우선
    // - 아니면 navigator.language 기반 자동 선택
    // =========================
    const STORAGE_KEY = "pwb_lang_v1";

    function normalizeLang(code){
      if(!code) return null;
      const c = code.toLowerCase();

      // 중국어: 지역 따라 한자체/번체 판단
      if(c.startsWith("zh")){
        // TW/HK/MO는 번체로 보는 편이 자연스러움
        if(c.includes("tw") || c.includes("hk") || c.includes("mo") || c.includes("hant")) return "zh-Hant";
        return "zh-Hans";
      }
      if(c.startsWith("ko")) return "ko";
      if(c.startsWith("ja")) return "ja";
      if(c.startsWith("en")) return "en";

      // 목록에 있으면 2글자라도 허용
      const short = c.slice(0,2);
      const exists = LANG_LIST.some(([v])=>v === short);
      return exists ? short : null;
    }

    function detectLang(){
      const saved = localStorage.getItem(STORAGE_KEY);
      if(saved && LANG_LIST.some(([v])=>v===saved)) return saved;

      const nav = normalizeLang(navigator.language || "");
      if(nav && LANG_LIST.some(([v])=>v===nav)) return nav;

      // 기본값: 한국어 (요청사항)
      return "ko";
    }

    // =========================
    // 4) UI 적용
    // =========================
    const $ = (id)=>document.getElementById(id);
    const langSelect = $("langSelect");

    function fillLangOptions(){
      LANG_LIST.forEach(([v, label])=>{
        const opt = document.createElement("option");
        opt.value = v;
        opt.textContent = label;
        langSelect.appendChild(opt);
      });
    }

    function getTextPack(lang){
      // 정의된 번역팩이 없으면 영어팩 사용(깨짐 방지)
      return T[lang] || T[FALLBACK_LANG] || T.ko;
    }

    function applyLang(lang){
      const pack = getTextPack(lang);

      document.documentElement.lang = lang.startsWith("zh") ? "zh" : lang;
      document.body.dir = pack.dir || "ltr";

      $("langLabel").textContent = pack.langLabel || "Language";
      $("people").textContent = pack.people || "";

      $("t1").textContent = pack.t1; $("d1").textContent = pack.d1;
      $("t2").textContent = pack.t2; $("d2").textContent = pack.d2;
      $("t3").textContent = pack.t3; $("d3").textContent = pack.d3;
      $("t4").textContent = pack.t4; $("d4").textContent = pack.d4;
      $("t5").textContent = pack.t5; $("d5").textContent = pack.d5;
      $("t6").textContent = pack.t6; $("d6").textContent = pack.d6;

      $("installTitle").textContent = pack.installTitle;
      $("installDesc").textContent = pack.installDesc;
      $("openBtn").textContent = pack.openBtn;
      $("installBtn").textContent = pack.installBtn;
      $("statusText").textContent = pack.status;
      $("installHint").textContent = pack.hint;

      localStorage.setItem(STORAGE_KEY, lang);
    }

    // =========================
    // 5) YouTube / TikTok 링크 (JS 없이 <a href>로 이미 안정화)
    // - 필요 시 여기서만 바꾸면 끝
    // =========================
    // 실제 채널/계정 링크가 생기면 아래 href만 교체하면 됩니다.
    // 현재는 기본값으로 유지.

    // =========================
    // 6) Pi Browser 열기 버튼
    // =========================
    $("openBtn").addEventListener("click", ()=>{
      // Pi Browser slug가 있다면 여기만 바꾸면 됨.
      // 지금은 안전하게 현재 URL을 새 탭으로 열어줌(깨짐 방지)
      window.open(location.href, "_blank");
    });

    // =========================
    // 7) 원클릭 설치 (PWA)
    // =========================
    let deferredPrompt = null;
    window.addEventListener("beforeinstallprompt", (e)=>{
      e.preventDefault();
      deferredPrompt = e;
      $("installBtn").disabled = false;
    });

    $("installBtn").addEventListener("click", async ()=>{
      if(!deferredPrompt){
        // 지원 안 되면 조용히 종료(깨짐 방지)
        return;
      }
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      $("installBtn").disabled = true;
    });

    // =========================
    // 8) 초기화 실행
    // =========================
    fillLangOptions();
    const initial = detectLang();
    langSelect.value = initial;
    applyLang(initial);

    langSelect.addEventListener("change", (e)=>{
      applyLang(e.target.value);
    });

    // service worker(있으면 등록, 없어도 무시)
    if("serviceWorker" in navigator){
      navigator.serviceWorker.register("./service-worker.js").catch(()=>{});
    }
  </script>
</body>
</html>
