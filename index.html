<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PiWorldBank â€” v5.3 (Token Swap Â· YouTube/TikTok bottom)</title>
  <meta name="description" content="PiWorldBank â€” UBI, Payments, Staking â‰¤15% APY, Rewards, Support. Token-swap demo. Multi-language." />
  <meta name="version" content="v5.3" />

  <!-- (ì˜µì…˜) ì„œë²„ ì—°ë™ìš© í† í° í›… -->
  <meta name="pwb-api-base" content="" />
  <meta name="pwb-api-token" content="" />

  <link rel="icon" href="assets/icons/icon-192.png" />
  <style>
    :root{
      --bg:#0A0720;--bg2:#130B2E;--panel:#1C0E35;--card:#241046;
      --text:#F5F2FF;--muted:#C9BFF0;--accent:#E2C24F;--ok:#63E6BE;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--text);
      background:radial-gradient(1200px 600px at 20% -10%, #402373 0%, var(--bg2) 40%, var(--bg) 100%);
      background-size:160% 160%;animation:bgshift 18s ease-in-out infinite;overflow-y:auto
    }
    @keyframes bgshift{0%{background-position:0% 30%}50%{background-position:100% 70%}100%{background-position:0% 30%}}
    .glass{background:rgba(255,255,255,.06);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.08)}
    header.app-header{display:flex;align-items:center;gap:14px;padding:12px 16px;position:sticky;top:0;z-index:40}
    .brand{display:flex;align-items:center;gap:10px;white-space:nowrap}
    .logo{width:40px;height:40px;border-radius:10px;flex:0 0 auto;filter:drop-shadow(0 6px 18px rgba(169,139,255,.18))}
    .titles{display:flex;flex-direction:column;min-width:0}
    .title-strong{margin:0;font-weight:900;font-size:clamp(18px,2vw,22px);letter-spacing:.2px}
    .subtitle{margin:2px 0 0;color:var(--muted);font-weight:600;font-size:12px;overflow:hidden;text-overflow:ellipsis}
    /* ì–¸ì–´ ì„ íƒ: ë” ì˜¤ë¥¸ìª½ + ë” ì‘ê²Œ */
    .lang-select{margin-left:auto}
    .lang-select select{
      background:linear-gradient(180deg,var(--card),#1B0D34);color:var(--text);
      border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:12px;font-weight:700;
      font-size:12px; /* í•œêµ­ì–´ ì‘ê²Œ */
    }

    .hero{text-align:center;max-width:1100px;margin:22px auto 6px;padding:8px 16px}
    .slogan{margin:0 0 6px;font-size:clamp(28px,4.6vw,56px);font-weight:1000;letter-spacing:.6px;line-height:1.05;text-shadow:0 0 18px rgba(169,139,255,.45)}
    .neon{background:linear-gradient(90deg,#fff,#c9bff0,#b399ff);-webkit-background-clip:text;background-clip:text;color:transparent;filter:drop-shadow(0 0 10px rgba(167,134,255,.25))}
    .hero-cta{display:flex;gap:10px;justify-content:center;margin:12px 0}
    .cta{padding:12px 18px;border-radius:14px;border:1px solid rgba(255,255,255,.16);font-weight:900;transition:.22s transform,.22s box-shadow}
    .cta.big{font-size:16px}.cta:not(.ghost){background:var(--accent);color:#1a1200}.cta.ghost{background:transparent;color:var(--text)}
    .cta:hover{transform:translateY(-2px);box-shadow:0 12px 24px rgba(0,0,0,.35)}

    .container{max-width:1100px;margin:0 auto;padding:8px 16px 28px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin:14px 0 24px}
    @media (max-width:780px){.grid{grid-template-columns:1fr}}
    .card{
      background:linear-gradient(180deg,var(--card),#1B0D34);border-radius:18px;padding:18px;
      border:1px solid rgba(255,255,255,.08);box-shadow:0 8px 20px rgba(0,0,0,.32);
      cursor:pointer;min-height:120px;transition:.22s transform,.22s box-shadow
    }
    .card.primary{outline:2px solid rgba(226,194,79,.45)}
    .card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,.45)}
    .card .icon{font-size:28px;margin-bottom:10px}
    .card .title{font-weight:900;margin-bottom:6px;font-size:17px;color:var(--text)}
    .card .desc{margin:0;color:var(--muted);font-size:14.6px;line-height:1.36}

    .panel{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin:12px 0 26px}
    @media (max-width:900px){.panel{grid-template-columns:1fr}}
    .panel-left,.panel-right{background:var(--panel);border-radius:18px;padding:18px;border:1px solid rgba(255,255,255,.08)}
    .panel-title{margin:0 0 8px;font-weight:900;color:var(--text)}
    .panel-text{margin:0 0 10px;color:var(--muted)}
    .qr{width:160px;height:160px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#000;object-fit:cover}

    .status{display:flex;flex-wrap:wrap;gap:18px;align-items:center;margin:6px 0 26px}
    .status-item{display:flex;align-items:center;gap:8px;color:var(--muted)}
    .dot{width:11px;height:11px;border-radius:50%}
    .dot.online{background:var(--ok)} .dot.shield{background:#7AA2F7} .dot.chain{background:#B388EB}

    footer.footer{display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center;padding:16px;margin-top:8px}
    footer .links{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    .btn-link{display:inline-block;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.16);text-decoration:none;font-weight:800;background:rgba(255,255,255,.06);color:var(--text)}
    .btn-link:hover{transform:translateY(-1px);box-shadow:0 8px 18px rgba(0,0,0,.3)}
    .copy{opacity:.8}

    /* ê°•ì œ ê°€ë…ì„± */
    body, .card .title, .card .desc, .panel-title, .panel-text, .status-item span, .subtitle { color: var(--text) !important; }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="app-header glass">
    <div class="brand">
      <img src="assets/icons/icon-192.png" alt="PiWorldBank logo" class="logo" />
      <div class="titles">
        <h1 id="app_title" class="title-strong">PiWorldBank</h1>
        <p id="tagline" class="subtitle">The web3 digital bank for all humanity</p>
      </div>
    </div>
    <div class="lang-select">
      <select id="langSwitcher" aria-label="Language Switcher">
        <option value="uk">Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ° ğŸ‡ºğŸ‡¦</option>
        <option value="en">English ğŸ‡ºğŸ‡¸</option>
        <option value="ko">í•œêµ­ì–´ ğŸ‡°ğŸ‡·</option>
        <option value="zh">ä¸­æ–‡ ğŸ‡¨ğŸ‡³</option>
        <option value="es">EspaÃ±ol ğŸ‡ªğŸ‡¸</option>
        <option value="pt-BR">PortuguÃªs (BR) ğŸ‡§ğŸ‡·</option>
        <option value="fr">FranÃ§ais ğŸ‡«ğŸ‡·</option>
        <option value="de">Deutsch ğŸ‡©ğŸ‡ª</option>
        <option value="it">Italiano ğŸ‡®ğŸ‡¹</option>
        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸ‡¸ğŸ‡¦</option>
        <option value="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€ ğŸ‡®ğŸ‡³</option>
        <option value="th">à¹„à¸—à¸¢ ğŸ‡¹ğŸ‡­</option>
        <option value="vi">Tiáº¿ng Viá»‡t ğŸ‡»ğŸ‡³</option>
        <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹ ğŸ‡·ğŸ‡º</option>
      </select>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <h2 class="slogan neon">One World Â· One Pi Â· One Future</h2>
    <!-- ìš”ì²­: ë°”ë¡œ ì•„ë˜ ë¬¸ì¥ ì‚­ì œë¨ -->
    <div class="hero-cta">
      <button id="btnInstall" class="cta big">Install App (PWA)</button>
      <button id="btnCache" class="cta ghost big">Cache for Offline</button>
    </div>
  </section>

  <!-- MAIN -->
  <main class="container">
    <section class="grid">
      <button class="card primary" data-action="ubi">
        <div class="icon">ğŸŒ</div>
        <div class="title" id="nav_ubi">UBI</div>
        <p class="desc" id="ubi_desc">Universal Basic Income pilot for pioneers.</p>
      </button>

      <button class="card" data-action="sendpay">
        <div class="icon">ğŸ’¸</div>
        <div class="title" id="nav_sendpay">Send / Pay</div>
        <p class="desc" id="sendpay_desc">Fast Pi transfers & QR payments.</p>
      </button>

      <button class="card" data-action="stake">
        <div class="icon">ğŸ“‰</div>
        <div class="title" id="nav_stake">Staking</div>
        <p class="desc" id="stake_desc">Stake Pi. â‰¤15% APY (demo).</p>
      </button>

      <button class="card" data-action="rewards">
        <div class="icon">ğŸ</div>
        <div class="title" id="nav_rewards">Rewards</div>
        <p class="desc" id="rewards_desc">Daily tasks & ecosystem rewards.</p>
      </button>

      <button class="card" data-action="support">
        <div class="icon">ğŸ’¬</div>
        <div class="title" id="nav_support">Support</div>
        <p class="desc" id="support_desc">KYC / policy / help center.</p>
      </button>

      <button class="card" data-action="login">
        <div class="icon">ğŸ”</div>
        <div class="title" id="nav_login">Login</div>
        <p class="desc" id="login_desc">Pi Browser login (Demo).</p>
      </button>

      <!-- Swapping -->
      <button class="card" data-action="swap">
        <div class="icon">ğŸ”</div>
        <div class="title">Swapping</div>
        <p class="desc">Pi â†” Asset swap (demo)</p>
      </button>
    </section>

    <section class="panel">
      <div class="panel-left">
        <h3 id="qr_title" class="panel-title">One-Touch QR</h3>
        <p id="qr_desc" class="panel-text">Scan in Pi Browser to open instantly.</p>
        <img src="assets/images/qr-demo.png" alt="QR Demo" class="qr" />
      </div>
      <div class="panel-right">
        <h3 id="demo_title" class="panel-title">Live Demo</h3>
        <ul class="panel-text" id="demo_bullets">
          <li>One-tap open in Pi Browser</li>
          <li>Offline-first PWA (installable)</li>
          <li>Web3 flows: UBI / Pay / Stake / Rewards / Swapping</li>
        </ul>
      </div>
    </section>

    <section class="status">
      <div class="status-item"><span class="dot online"></span><span id="status_online">Ready</span></div>
      <div class="status-item"><span class="dot shield"></span><span id="status_security">Security hardened (demo)</span></div>
      <div class="status-item"><span class="dot chain"></span><span id="status_chain">Mainnet-ready UX (demo)</span></div>
    </section>
  </main>

  <!-- FOOTER (ìš”ì²­: ìœ íŠœë¸ŒÂ·í‹±í†¡ ë§¨ ì•„ë˜ë¡œ) -->
  <footer class="footer glass">
    <div class="links">
      <a class="btn-link" href="https://youtube.com/@YOUR_CHANNEL" target="_blank" rel="noopener">Open YouTube</a>
      <a class="btn-link" href="https://tiktok.com/@YOUR_HANDLE" target="_blank" rel="noopener">Open TikTok</a>
    </div>
    <div class="copy">
      <strong>PiWorldBank</strong> Â· Â© 2025 v5.3
      &nbsp;Â·&nbsp; <a href="#" id="footer_terms" class="btn-link" style="padding:6px 10px">Terms</a>
      <a href="#" id="footer_policy" class="btn-link" style="padding:6px 10px">Policy</a>
      <a href="#" id="footer_contact" class="btn-link" style="padding:6px 10px">Contact</a>
    </div>
  </footer>

  <!-- LANG PACK (ìš”ì²­ ì–¸ì–´ ìš°ì„ : uk/en/ko) -->
  <script>
    window.PWB_LANGS={
      uk:{app_title:"PiWorldBank",tagline:"The web3 digital bank for all humanity",nav_ubi:"UBI",nav_sendpay:"ĞĞ°Ğ´Ñ–ÑĞ»Ğ°Ñ‚Ğ¸ / ĞĞ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚Ğ¸",nav_stake:"Ğ¡Ñ‚ĞµĞ¹ĞºÑ–Ğ½Ğ³",nav_rewards:"Ğ’Ğ¸Ğ½Ğ°Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ¸",nav_support:"ĞŸÑ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºĞ°",nav_login:"Ğ£Ğ²Ñ–Ğ¹Ñ‚Ğ¸",ubi_desc:"ĞŸÑ–Ğ»Ğ¾Ñ‚ Universal Basic Income Ğ´Ğ»Ñ Ğ¿Ñ–Ğ¾Ğ½ĞµÑ€Ñ–Ğ².",sendpay_desc:"Ğ¨Ğ²Ğ¸Ğ´ĞºÑ– Ğ¿ĞµÑ€ĞµĞºĞ°Ğ·Ğ¸ Pi Ñ‚Ğ° QR-Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¸.",stake_desc:"Ğ¡Ñ‚ĞµĞ¹ĞºÑ–Ğ½Ğ³ Pi. â‰¤15% APY (Ğ´ĞµĞ¼Ğ¾).",rewards_desc:"Ğ©Ğ¾Ğ´ĞµĞ½Ğ½Ñ– Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½Ñ Ñ‚Ğ° Ğ²Ğ¸Ğ½Ğ°Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ¸ ĞµĞºĞ¾ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸.",support_desc:"KYC / Ğ¿Ğ¾Ğ»Ñ–Ñ‚Ğ¸ĞºĞ° / Ñ†ĞµĞ½Ñ‚Ñ€ Ğ´Ğ¾Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ¸.",login_desc:"Ğ’Ñ…Ñ–Ğ´ Ñ‡ĞµÑ€ĞµĞ· Pi Browser (Ğ´ĞµĞ¼Ğ¾).",qr_title:"One-Touch QR",qr_desc:"Ğ¡ĞºĞ°Ğ½ÑƒĞ¹Ñ‚Ğµ Ğ² Pi Browser, Ñ‰Ğ¾Ğ± Ğ¼Ğ¸Ñ‚Ñ‚Ñ”Ğ²Ğ¾ Ğ²Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¸ Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¾Ğº.",demo_title:"Ğ–Ğ¸Ğ²Ğµ Ğ´ĞµĞ¼Ğ¾",demo_bullets:["One-tap open Ğ² Pi Browser","PWA (Ğ¾Ñ„Ğ»Ğ°Ğ¹Ğ½-ÑĞ¿ĞµÑ€ÑˆÑƒ), Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ÑÑ”Ñ‚ÑŒÑÑ","Web3: UBI / Pay / Stake / Rewards / Swapping"],status_online:"Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾",status_security:"ĞŸĞ¾ÑĞ¸Ğ»ĞµĞ½Ğ° Ğ±ĞµĞ·Ğ¿ĞµĞºĞ° (Ğ´ĞµĞ¼Ğ¾)",status_chain:"Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ñ–ÑÑ‚ÑŒ Ğ´Ğ¾ Mainnet (Ğ´ĞµĞ¼Ğ¾)",footer_terms:"Ğ£Ğ¼Ğ¾Ğ²Ğ¸",footer_policy:"ĞŸĞ¾Ğ»Ñ–Ñ‚Ğ¸ĞºĞ°",footer_contact:"ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¸"},
      en:{app_title:"PiWorldBank",tagline:"The web3 digital bank for all humanity",nav_ubi:"UBI",nav_sendpay:"Send / Pay",nav_stake:"Staking",nav_rewards:"Rewards",nav_support:"Support",nav_login:"Login",ubi_desc:"Universal Basic Income pilot for pioneers.",sendpay_desc:"Fast Pi transfers & QR payments.",stake_desc:"Stake Pi. â‰¤15% APY (demo).",rewards_desc:"Daily tasks & ecosystem rewards.",support_desc:"KYC / policy / help center.",login_desc:"Pi Browser login (demo).",qr_title:"One-Touch QR",qr_desc:"Scan in Pi Browser to open the app instantly.",demo_title:"Live Demo",demo_bullets:["One-tap open in Pi Browser","Offline-first PWA (installable)","Web3: UBI / Pay / Stake / Rewards / Swapping"],status_online:"Ready",status_security:"Security hardened (demo)",status_chain:"Mainnet-ready UX (demo)",footer_terms:"Terms",footer_policy:"Policy",footer_contact:"Contact"},
      ko:{app_title:"PiWorldBank",tagline:"The web3 digital bank for all humanity",nav_ubi:"UBI",nav_sendpay:"ì†¡ê¸ˆ / ê²°ì œ",nav_stake:"ì˜ˆì¹˜(ìŠ¤í…Œì´í‚¹)",nav_rewards:"ë¦¬ì›Œë“œ",nav_support:"ê³ ê°ì„¼í„°",nav_login:"ë¡œê·¸ì¸",ubi_desc:"íŒŒì´ì˜¤ë‹ˆì–´ë¥¼ ìœ„í•œ UBI íŒŒì¼ëŸ¿.",sendpay_desc:"ë¹ ë¥¸ íŒŒì´ ì†¡ê¸ˆê³¼ QR ê²°ì œ.",stake_desc:"íŒŒì´ ì˜ˆì¹˜. â‰¤15% APY (ë°ëª¨).",rewards_desc:"ì¼ì¼ ë¯¸ì…˜ & ìƒíƒœê³„ ë³´ìƒ.",support_desc:"KYC / ì •ì±… / í—¬í”„ì„¼í„°.",login_desc:"Pi ë¸Œë¼ìš°ì € ë¡œê·¸ì¸ (ë°ëª¨).",qr_title:"ì›í„°ì¹˜ QR",qr_desc:"Pi ë¸Œë¼ìš°ì €ë¡œ ìŠ¤ìº”í•˜ë©´ ì¦‰ì‹œ ì‹¤í–‰.",demo_title:"ë¼ì´ë¸Œ ë°ëª¨",demo_bullets:["Pi ë¸Œë¼ìš°ì € ì›íƒ­ ì‹¤í–‰","ì„¤ì¹˜í˜• PWA(ì˜¤í”„ë¼ì¸ ìš°ì„ )","Web3: UBI / Pay / Stake / Rewards / Swapping"],status_online:"ì¤€ë¹„ë¨",status_security:"ë³´ì•ˆ ê°•í™” (ë°ëª¨)",status_chain:"ë©”ì¸ë„·ê¸‰ UX (ë°ëª¨)",footer_terms:"ì´ìš©ì•½ê´€",footer_policy:"ì •ì±…",footer_contact:"ë¬¸ì˜"}
    };
  </script>

  <!-- CORE SCRIPT (í† í° ìŠ¤ì™‘ í¬í•¨) -->
  <script>
    /* ===== i18n ===== */
    const LANG_DEFAULT="uk";
    const map={app_title:"app_title",tagline:"tagline",nav_ubi:"nav_ubi",nav_sendpay:"nav_sendpay",nav_stake:"nav_stake",nav_rewards:"nav_rewards",nav_support:"nav_support",nav_login:"nav_login",ubi_desc:"ubi_desc",sendpay_desc:"sendpay_desc",stake_desc:"stake_desc",rewards_desc:"rewards_desc",support_desc:"support_desc",login_desc:"login_desc",qr_title:"qr_title",qr_desc:"qr_desc",demo_title:"demo_title",demo_bullets:"demo_bullets",status_online:"status_online",status_security:"status_security",status_chain:"status_chain",footer_terms:"footer_terms",footer_policy:"footer_policy",footer_contact:"footer_contact"};

    function enforceAPY15(el){ if(!el) return; let t=el.textContent||""; t=t.replace(/(\d+([.,]\d+)?)\s*%/g,"15%"); if(!/â‰¤\s*15%/.test(t)) t=t.replace(/15%/,"â‰¤15%"); if(!/APY/i.test(t)) t+=" APY"; el.textContent=t; }
    function forceAllAPY15(){ enforceAPY15(document.getElementById("stake_desc")); document.querySelectorAll(".desc").forEach(enforceAPY15); }

    function applyLanguage(code){
      const d=(window.PWB_LANGS&&window.PWB_LANGS[code])||window.PWB_LANGS[LANG_DEFAULT];
      if(!d) return;
      Object.entries(map).forEach(([k,id])=>{
        const el=document.getElementById(id); if(!el) return;
        if(k==="demo_bullets"&&Array.isArray(d[k])) el.innerHTML=d[k].map(x=>`<li>${x}</li>`).join("");
        else el.textContent=d[k]||"";
      });
      forceAllAPY15();
      document.documentElement.lang=code;
      try{localStorage.setItem("pwb_lang",code);}catch(e){}
    }

    (function initLang(){
      const s=document.getElementById("langSwitcher");
      const saved=localStorage.getItem("pwb_lang");
      s.value=(saved&&window.PWB_LANGS[saved])?saved:LANG_DEFAULT;
      applyLanguage(s.value);
      s.addEventListener("change",e=>applyLanguage(e.target.value));
    })();

    /* ===== PWA basics ===== */
    let deferredPrompt=null; window.addEventListener("beforeinstallprompt",e=>{e.preventDefault();deferredPrompt=e;});
    document.getElementById("btnInstall")?.addEventListener("click",async()=>{ if(!deferredPrompt) return alert("Install prompt not available"); deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; });
    document.getElementById("btnCache")?.addEventListener("click",async()=>{ await fetch(location.href+"?cache="+Date.now()).catch(()=>{}); alert("Core content cached."); });

    /* ===== Card actions ===== */
    document.querySelectorAll(".card").forEach(c=>{
      c.addEventListener("click",()=>{
        const a=c.getAttribute("data-action");
        switch(a){
          case "ubi": alert("UBI demo: Claim mock cycle."); break;
          case "sendpay": alert("Send/Pay demo: QR pay (mock)."); break;
          case "stake": alert("Staking demo: â‰¤15% APY simulation."); break;
          case "rewards": alert("Rewards: Daily tasks (mock)."); break;
          case "support": alert("Support: KYC / policy / help center."); break;
          case "login": alert("Login: Pi Browser SSO placeholder."); break;
          case "swap": openSwap(); break;
        }
      });
    });

    /* ===== Token & API hooks ===== */
    function cfg(name){ const m=document.querySelector(`meta[name="${name}"]`); return m?m.content:""; }
    const API_BASE_DEFAULT=""; // ë¹ˆ ê°’ì´ë©´ ë¡œì»¬ ë°ëª¨
    let API_BASE = cfg("pwb-api-base") || API_BASE_DEFAULT;
    let API_TOKEN = cfg("pwb-api-token") || "";

    // URL ?token=.. ë¡œ ë®ì–´ì“°ê¸°
    const qs=new URLSearchParams(location.search);
    if(qs.get("token")) API_TOKEN = qs.get("token");
    // localStorage ìš°ì„ ìˆœìœ„(ê°œë°œ í¸ì˜)
    API_TOKEN = localStorage.getItem("pwb_token") || API_TOKEN;

    async function apiSwapQuote(from,to,amount){
      if(!API_BASE||!API_TOKEN){ // ë°ëª¨ ëª¨ë“œ
        const rate=288; // demo rate
        let out=0;
        if(from==="PI"&&to==="USD") out=amount*rate;
        else if(from==="USD"&&to==="PI") out=amount/rate;
        else out=amount;
        return { outAmount: out, rate };
      }
      const r=await fetch(`${API_BASE}/swap/quote`,{
        method:"POST",
        headers:{ "Content-Type":"application/json","Authorization":`Bearer ${API_TOKEN}` },
        body:JSON.stringify({from,to,amount})
      });
      if(!r.ok) throw new Error("swap/quote failed");
      return r.json();
    }

    /* ===== Swapping modal ===== */
    const modal=document.createElement("div"); modal.className="modal"; modal.innerHTML=`
      <div class="modal-card">
        <h3>Swapping (Demo)</h3>
        <div class="row">
          <select id="swapFrom"><option value="PI">PI</option><option value="USD">USD</option></select>
          <input id="amtFrom" type="number" min="0" step="0.0001" placeholder="Amount" />
        </div>
        <div class="row">
          <select id="swapTo"><option value="USD">USD</option><option value="PI">PI</option></select>
          <input id="amtTo" type="text" placeholder="Estimated" readonly />
        </div>
        <div class="row"><small id="rateNote">Rate: â€”</small></div>
        <div class="modal-actions">
          <button class="btn" id="swapClose">Close</button>
          <button class="btn primary" id="swapExec">Swap (mock/server)</button>
        </div>
      </div>`;
    document.body.appendChild(modal);

    function openSwap(){ modal.classList.add("open"); calcQuote(); }
    function closeSwap(){ modal.classList.remove("open"); }
    document.addEventListener("click",e=>{ if(e.target.id==="swapClose") closeSwap(); if(e.target===modal) closeSwap(); });
    document.addEventListener("input",e=>{ if(["swapFrom","swapTo","amtFrom"].includes(e.target.id)) calcQuote(); });

    async function calcQuote(){
      const from=document.getElementById("swapFrom").value;
      const to=document.getElementById("swapTo").value;
      const amt=parseFloat(document.getElementById("amtFrom").value||"0");
      try{
        const res=await apiSwapQuote(from,to,amt);
        document.getElementById("amtTo").value=(res.outAmount??0).toFixed(4);
        document.getElementById("rateNote").textContent=`Rate: 1 PI â‰ˆ ${res.rate??288} USD ${API_BASE?"(server)":"(demo)"}`;
      }catch(e){
        document.getElementById("amtTo").value="0.0000";
        document.getElementById("rateNote").textContent="Rate: error";
      }
    }

    document.getElementById("swapExec")?.addEventListener("click",async()=>{
      const from=document.getElementById("swapFrom").value;
      const to=document.getElementById("swapTo").value;
      const amt=parseFloat(document.getElementById("amtFrom").value||"0");
      try{
        const res=await apiSwapQuote(from,to,amt);
        alert("Swap OK: "+(res.outAmount??0).toFixed(4)+" "+to);
      }catch(e){ alert("Swap error: "+e.message); }
    });

    /* ===== Keep APY text enforced ===== */
    setInterval(forceAllAPY15,2200);
  </script>
</body>
</html>
